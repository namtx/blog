<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Best practices for Operating Containers | namtx.dev </title> <meta name="description" content=" Best practices for Operating Containers "> <meta name="keywords" content="docker, best-practices"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Tran Xuan Nam"> <meta property="article:section" content=""> <meta property="article:tag" content="docker, best-practices"> <meta property="article:published_time" content="2020-07-15 00:00:00 +0000"> <meta property="og:url" content="https://namtx.github.io/2020/best-practices-for-operating-containers/"> <meta property="og:title" content=" Best practices for Operating Containers | namtx.dev "> <meta property="og:image" content="https://namtx.github.io"> <meta property="og:description" content=" Best practices for Operating Containers "> <meta property="og:site_name" content="Tran Xuan Nam"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" Best practices for Operating Containers | namtx.dev "> <meta name="twitter:description" content=" Best practices for Operating Containers "> <meta name="twitter:image:src" content="https://namtx.github.io"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Best practices for Operating Containers | namtx.dev "> <meta itemprop="description" content=" Best practices for Operating Containers "> <meta itemprop="image" content="https://namtx.github.io"> <!-- Canonical link tag --> <link rel="canonical" href="https://namtx.github.io/2020/best-practices-for-operating-containers/"> <link rel="alternate" type="application/rss+xml" title="namtx.dev" href="https://namtx.github.io/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="https://namtx.github.io/assets/css/main.css"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="icon" href="/favicon.ico" type="image/x-icon"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="https://namtx.github.io/">namtx<span>.dev</span></a></h1> <ul class="navbar"> <li><a href="https://namtx.github.io/about">About me</a></li> <li><a href="https://bookmarks.namtx.now.sh/" target="_blank">Bookmarks</a></li> <li><a href="https://namtx.github.io/til">TIL</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2020-07-15T00:00:00+00:00" itemprop="datePublished">Jul 15, 2020</time></p> <h1 class="post-title" itemprop="name headline">Best practices for Operating Containers</h1> </header> <div class="post-content" itemprop="articleBody"> <h3 id="use-native-logging-mechanisms-of-container">Use native logging mechanisms of container</h3> <ul> <li>Write log to <code class="highlighter-rouge">stdout</code>, <code class="highlighter-rouge">stderr</code></li> <li>Use <code class="highlighter-rouge">docker logs</code></li> <li>Centralize logs and make them searchable: <a href="https://www.fluentd.org/">fluentd</a>, EFK stack (Elastic Search, Fluentd, Kibana) <img src="https://cloud.google.com/solutions/images/bp-operating-containers-log-management.svg" alt="typical log management system in k8s" /></li> <li>JSON logs <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2018-01-01 01:01:01</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">component</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">subcomponent</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foo.bar</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">level</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">WARNING</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">There is something wrong.</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li>Log aggregator sidecar pattern <img src="https://cloud.google.com/solutions/images/bp-operating-containers-sidecar.svg" alt="sidecar pattern" /></li> </ul> <h3 id="ensure-your-containers-stateless-and-immutable">Ensure your containers stateless and immutable</h3> <ul> <li>Externalize the container configuration (listening port, runtime options,â€¦)</li> <li>Use <code class="highlighter-rouge">ConfigMap</code> to run same container image across different environment</li> <li>Use <code class="highlighter-rouge">Secrets</code> and <code class="highlighter-rouge">ConfigMap</code> to inject configuration in containers as environment variables or files. <img src="https://cloud.google.com/solutions/images/bp-operating-containers-configmap.svg" alt="configmap with same image" /></li> </ul> <h3 id="avoid-privileged-containers">Avoid privileged containers</h3> <ul> <li>If your application must modify the host settings in order to run, modify those settings either in a sidecar container or an <code class="highlighter-rouge">init container</code>.</li> <li>Sidecar container does NOT need to be exposed either internal or external traffic.</li> </ul> <h3 id="make-your-application-easy-to-monitor">Make your application easy to monitor</h3> <ul> <li><code class="highlighter-rouge">/metrics</code> endpoint with Prometheus client library</li> <li>Sidecar pattern when your application can not instrument with a <code class="highlighter-rouge">/metrics</code> endpoint <img src="https://cloud.google.com/solutions/images/bp-operating-containers-monitoring.svg" alt="sidecar metrics" /></li> <li>Expose your health of your application: Liveness, Readiness</li> </ul> <h3 id="avoid-running-as-root">Avoid running as root</h3> <ul> <li>If you are running <strong>single application per container</strong> and single application with single user (not root), you can grant all users write permissions to the folders and files that need to be written in, make all the other folders and files only writable by root</li> <li>Simple way to check container permission by run <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--user</span> <span class="k">$((</span>RANDOM+1<span class="k">))</span> <span class="o">[</span>YOUR_CONTAINER]
</code></pre></div> </div> </li> </ul> <h3 id="carefully-image-version">Carefully image version</h3> <ul> <li>Sematic version</li> <li>Avoid using <code class="highlighter-rouge">latest</code> tag</li> <li>Prefer minor version over path version for automatically securities patch</li> </ul> <h3 id="conclusion">Conclusion</h3> <p>References:</p> <ul> <li><a href="https://cloud.google.com/solutions/best-practices-for-operating-containers">https://cloud.google.com/solutions/best-practices-for-operating-containers</a></li> </ul> </div> </article> <footer class="site-footer"> <div class="container"> <small class="block">&copy; 2021 Tran Xuan Nam &middot; &lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/thinkspace">Thinkspace theme</a></small> </div> </footer> </main> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-XXXXX-XX']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>
