<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> lazyloading images | namtx.dev </title> <meta name="description" content=" Ruby on Rails, Devops and more "> <meta name="keywords" content="blog, web, devops, ruby on rails"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Tran Xuan Nam"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2021-01-13 00:00:00 +0000"> <meta property="og:url" content="https://namtx.github.io/2021/lazyloading_images/"> <meta property="og:title" content=" lazyloading images | namtx.dev "> <meta property="og:image" content="https://namtx.github.io"> <meta property="og:description" content=" Ruby on Rails, Devops and more "> <meta property="og:site_name" content="Tran Xuan Nam"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" lazyloading images | namtx.dev "> <meta name="twitter:description" content=" Ruby on Rails, Devops and more "> <meta name="twitter:image:src" content="https://namtx.github.io"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" lazyloading images | namtx.dev "> <meta itemprop="description" content=" Ruby on Rails, Devops and more "> <meta itemprop="image" content="https://namtx.github.io"> <!-- Canonical link tag --> <link rel="canonical" href="https://namtx.github.io/2021/lazyloading_images/"> <link rel="alternate" type="application/rss+xml" title="namtx.dev" href="https://namtx.github.io/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="https://namtx.github.io/assets/css/main.css"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="icon" href="/favicon.ico" type="image/x-icon"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="https://namtx.github.io/">namtx<span>.dev</span></a></h1> <ul class="navbar"> <li><a href="https://namtx.github.io/about">About me</a></li> <li><a href="https://bookmarks.namtx.now.sh/" target="_blank">Bookmarks</a></li> <li><a href="https://namtx.github.io/til">TIL</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2021-01-13T00:00:00+00:00" itemprop="datePublished">Jan 13, 2021</time></p> <h1 class="post-title" itemprop="name headline">lazyloading images</h1> </header> <div class="post-content" itemprop="articleBody"> <p> <span class="issue-label" style="background-color: #792da8">css</span> <span class="issue-label" style="background-color: #C2D3D7">frontend</span> </p> <p>Làm thế nào để lazy load img? What: lazy load nghĩa là mình không load resource nào đó trước khi mình thật sự cần đến chúng. Why: Page load time tốt hơn, tiết kiệm được bandwidth, trải nghiệm người dùng mượt hơn. How: Legacy: Thay vì set url ở src , chuyển thành attribute data-src . Gán class foo cho các img cần lazy load. On scroll, resize, orientation change, chọn .foo , dựa vào offset hoặc boundingRect để xác định img đang nằm trong viewport -&gt; switch data-src thành src để tiến hành load và remove class. Modern: Tương tự như trên, nhưng dùng Intersection Observer API để observe và trigger load (Không support IE) Pitfalls: Layout Reflow: Do img chưa được load có height bằng 0 (và width có thể chưa xác định) nên khi img được load, nó sẽ trigger reflow (page content được sắp xếp lại để nhường chỗ cho img vừa được load). Việc này ngoài gây ra trải nghiệm người dùng kém thì nó còn ảnh hưởng để performance, vì khi trigger reflow thì browser sẽ trigger quá trình calculate layout và rendering pipeline phía sau đó nữa. Solution: Dùng placeholder để thế chỗ cho img chưa được load. Nếu biết dimension, có thể set fixed dimension cho container. Nếu biết được aspect ratio, có thể dùng inline placeholder bằng png hoặc svg, hay thậm chí là CSS. Nhưng khỏe nhất và xịn nhất thì dùng Low-quality image placeholders (LQIPs), cái này nhiều asset source sẽ generate ra sẵn khi bạn upload, còn không có thì hãy đi vận động hành lang để có :vayvay: No javascript: Lưu ý cần cung cấp fallback (noscript) trong trường hợp người dùng tắt js hoặc không load đc js vẫn có thể thấy được img. Cái này cũng có issue của riêng nó, nhưng có lẽ sẽ đề cập ở một post nào đó khác.</p> <p><br /></p> <p>Source: Webuild</p> </div> </article> <footer class="site-footer"> <div class="container"> <small class="block">&copy; 2021 Tran Xuan Nam &middot; &lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/thinkspace">Thinkspace theme</a></small> </div> </footer> </main> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-XXXXX-XX']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>
